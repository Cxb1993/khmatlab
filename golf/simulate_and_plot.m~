function [msim, objd, mse] = simulate_and_plot (gm, states, dataframes, mdata, markers2plot, plotit)
	 
	 %% usage: [msim, objsim, mse] = simulate_and_plot (gm, states, dataframes, mdata, markers2plot, plotit)
	 %% 
	 %% 
	 
%% Kjartan Halvorsen
%% 2013-10-09

[nsts, nfrs] = size(states);
[msim, simnames, objd, objnames] = sim_model(gm, states(1:nsts/2,:), 'objectcenter');


if plotit
  % Plot results
  y_observations=extractmarkers(mdata, simnames);
  y_observations(find(y_observations==0)) = NaN;
  mse = plotmarkers(y_observations(find(dataframes),:), ...
 		    simnames,...
 		    msim, simnames, markers2plot, {'data', 'model'});
end




